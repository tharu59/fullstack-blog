<%- include("partials/header.ejs") %>
<h1 class="text-center mb-4">
  <i class="fas fa-plus-circle text-success me-2"></i>Create New Post
</h1>

<!-- Success message -->
<% if (typeof success !== 'undefined' && success) { %>
<div class="alert alert-success alert-dismissible fade show" role="alert">
  <i class="fas fa-check-circle me-2"></i>
  <%= success %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %>

<!-- Error message (add this too for consistency) -->
<% if (typeof error !== 'undefined' && error) { %>
<div class="alert alert-danger alert-dismissible fade show" role="alert">
  <i class="fas fa-exclamation-circle me-2"></i>
  <%= error %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %>

<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow">
      <div class="card-body p-4">
        <form action="/posts/add" method="post" enctype="multipart/form-data" onsubmit="return validationForm()"   autocomplete="off">
          <div class="mb-3">
            <label for="title" class="form-label">
              <i class="fas fa-heading me-2"></i>Title
            </label>
            <input 
              type="text" 
              class="form-control" 
              id="title" 
              name="title" 
              placeholder="Enter post title" 
              
            />
          </div>

          <div class="mb-3">
            <label for="content" class="form-label">
              <i class="fas fa-edit me-2"></i>Content
            </label>
            <textarea 
              class="form-control" 
              id="content" 
              name="content" 
              rows="8" 
              placeholder="Write your post content here..."
              
            ></textarea>
          </div>

          <div class="mb-3">
            <label for="image" class="form-label">
              <i class="fas fa-images me-2"></i>Images (Multiple allowed)
            </label>
            <input 
              type="file" 
              class="form-control" 
              id="image" 
              name="images" 
              multiple 
              accept="image/*" 
              
              onchange="previewImages()"
            />
            <div class="form-text">Upload at least one image (JPG, PNG, GIF)</div>
            <div class="mt-3" id="image-preview"></div>
          </div>

          <button type="submit" class="btn btn-success w-100">
            <i class="fas fa-paper-plane me-2"></i>Create Post
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
  function previewImages(){
    const preview = document.getElementById("image-preview");
    preview.innerHTML = "";
    const files = document.getElementById("image").files;
    // console.log(files)
    for(let i=0;i<files.length;i++)
    {
      const img = document.createElement("img");
      img.src=URL.createObjectURL(files[i]);
      img.classList.add("img-thumbnail", "mr-2","mb-2");
      img.style.maxWidth = "150px";
      preview.appendChild(img);
    }
  }
  function validationForm(){
    const title = document.getElementById("title").value;
    const content = document.getElementById("content").value
    if(!title || !content)
  {
    alert("Please fill in all fields");
    return false;
  }

  // from Gemini
// const titleEl = document.getElementById("title");
//   const contentEl = document.getElementById("content");
//   const imageEl = document.getElementById("image");

//   // 1. Check Title
//   if (titleEl.value.trim() === "") {
//     titleEl.setCustomValidity("Please enter a title"); 
//     titleEl.reportValidity(); 
//     return false;
//   } else {
//     titleEl.setCustomValidity(""); 
//   }

//   // 2. Check Content
//   if (contentEl.value.trim() === "") {
//     contentEl.setCustomValidity("Please fill out the details"); 
//     contentEl.reportValidity(); 
//     return false;
//   } else {
//     contentEl.setCustomValidity("");
//   }

//   // 3. Check Images
//   if (imageEl.files.length === 0) {
//     imageEl.setCustomValidity("At least one image is required");
//     imageEl.reportValidity();
//     return false;
//   } else {
//     imageEl.setCustomValidity("");
//   }

  return true;
  }

</script>

<%- include("partials/footer.ejs") %>
