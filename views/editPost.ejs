<%- include("partials/header.ejs") %>
<h1 class="text-center mb-4">
  <i class="fas fa-edit text-warning me-2"></i>Edit Post
</h1>

<!-- Error message (add this too for consistency) -->
<% if (typeof error !== 'undefined' && error) { %>
<div class="alert alert-danger alert-dismissible fade show" role="alert">
  <i class="fas fa-exclamation-circle me-2"></i>
  <%= error %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %>

<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow">
      <div class="card-body p-4">
        <form action="/posts/<%= post._id %>/update" method="post" enctype="multipart/form-data" autocomplete="off">
          <div class="mb-3">
            <label for="title" class="form-label">
              <i class="fas fa-heading me-2"></i>Title
            </label>
            <input
              type="text"
              class="form-control"
              id="title"
              name="title"
              value="<%= post.title %>"
              placeholder="Enter post title" 
              required
            />
          </div>

          <div class="mb-3">
            <label for="content" class="form-label">
              <i class="fas fa-edit me-2"></i>Content
            </label>
            <textarea 
              class="form-control" 
              id="content" 
              name="content" 
              rows="8" 
              placeholder="Write your post content here..."
              required
            ><%= post.content %></textarea>
          </div>

          <div class="mb-3">
            <label for="category" class="form-label">
              <i class="fas fa-tag me-2"></i>Category
            </label>
            <select class="form-select" id="category" name="category">
              <% const categories = ["General", "Technology", "Coding", "Lifestyle", "Design", "Health", "Business"]; %>
              <% categories.forEach(cat => { %>
                <option value="<%= cat %>" <%= post.category === cat ? 'selected' : '' %>><%= cat %></option>
              <% }) %>
            </select>
          </div>

          <div class="mb-3">
            <label for="image" class="form-label">
              <i class="fas fa-images me-2"></i>Add New Images (Optional)
            </label>
            <input 
              type="file" 
              class="form-control" 
              id="image" 
              name="images" 
              multiple 
              accept="image/*" 
              onchange="previewImages()"
            />
            <div class="mt-3" id="image-preview"></div>
          </div>
          
          <% if(post.images && post.images.length > 0) { %>
            <div class="mb-3">
              <label class="form-label">Current Images:</label>
              <div class="d-flex flex-wrap gap-2">
                <% post.images.forEach(img => { %>
                  <img src="<%= img.url %>" class="img-thumbnail" style="width: 100px; height: 100px; object-fit: cover;">
                <% }) %>
              </div>
            </div>
          <% } %>

          <div class="d-flex justify-content-between">
            <a href="/posts/<%= post._id %>" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-warning text-white">
              <i class="fas fa-save me-2"></i>Update Post
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
  function previewImages(){
    const preview = document.getElementById("image-preview");
    preview.innerHTML = "";
    const files = document.getElementById("image").files;
    for(let i=0;i<files.length;i++)
    {
      const img = document.createElement("img");
      img.src=URL.createObjectURL(files[i]);
      img.classList.add("img-thumbnail", "mr-2","mb-2");
      img.style.maxWidth = "150px";
      preview.appendChild(img);
    }
  }
</script>

<%- include("partials/footer.ejs") %>
