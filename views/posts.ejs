<%- include('partials/header', { title: title, user: user }) %>

<style>
  :root {
    --glass-bg: rgba(255, 255, 255, 0.9);
    --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
  }

  body { background-color: #f8fafc; }

  /* Fixed Header Styling */
  .fixed-controls {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.05);
    padding: 1.5rem 0;
  }

  /* Card Styling */
  .post-card {
    border: none;
    border-radius: 16px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
    background: white;
  }

  .post-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  }

  /* Image Fix: "Contain" ensures the whole image is visible without cutting */
  .image-wrapper {
    width: 100%;
    height: 220px;
    background-color: #f1f5f9; /* Light background for transparent/small images */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .post-image {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Change to 'contain' if you want to see the whole image including borders */
    transition: transform 0.5s ease;
  }

  .post-card:hover .post-image {
    transform: scale(1.1);
  }

  .btn-modern {
    background: var(--primary-gradient);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: 600;
    transition: opacity 0.2s;
  }

  .btn-modern:hover {
    color: white;
    opacity: 0.9;
  }

  .author-badge {
    background: #f1f5f9;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    color: #475569;
  }
</style>

<div class="fixed-controls mb-4">
  <div class="container d-flex justify-content-between align-items-center">
    <div>
      <h2 class="fw-bold mb-0" style="letter-spacing: -1px;">Explore Posts</h2>
      <p class="text-muted small mb-0">Discover what's happening in the community</p>
    </div>
    <a href="/posts/add" class="btn btn-modern shadow-sm">
      + New Post
    </a>
  </div>
</div>

<div class="container pb-5">
  <div class="row g-4">
    <% if (posts?.length > 0) { %>
      <% posts.forEach(post => { %>
        <div class="col-lg-4 col-md-6">
          <article class="card post-card h-100 shadow-sm">
            
            
            <div class="image-wrapper">
              <% if (post.images && post.images.length > 0) { %>
                <img src="<%= post.images[0].url %>" class="post-image" alt="<%= post.title %>">
              <% } else { %>
                <div class="text-muted small">No Image</div>
              <% } %>
            </div>

            <div class="card-body d-flex flex-column p-4">
              <div class="mb-2">
                <span class="author-badge">
                  <i class="bi bi-person"></i> <%= post.author?.username || 'tharun' %>
                </span>
              </div>

              <h4 class="card-title fw-bold text-dark"><%= post.title %></h4>
              
              <p class="card-text text-secondary small flex-grow-1">
                <%= post.content.substring(0, 100) %>...
              </p>

              <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                <small class="text-muted">
                  <%= new Date(post.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %>
                </small>
                <a href="/posts/<%= post._id %>" class="text-primary fw-bold text-decoration-none small">
                  Read Full Post â†’
                </a>
              </div>
            </div>
          </article>
        </div>
      <% }) %>
    <% } else { %>
      <div class="col-12 text-center py-5">
        <p class="text-muted">No posts yet. Be the first to share something!</p>
      </div>
    <% } %>
  </div>
</div>

<%- include('partials/footer') %>